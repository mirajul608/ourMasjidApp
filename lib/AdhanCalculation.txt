Developing a prayer time feature for your masjid app is a great idea, and with your chosen technology stack (Flutter + Firebase), you're well-positioned to build a robust and cross-platform solution. Here's a step-by-step guide on how you can develop the prayer time feature in your app:

### **Steps to Develop the Prayer Time Feature**

---

### **1. Understand Prayer Time Calculation Logic**

The prayer times depend on several parameters, including the calculation method (e.g., Muslim World League, ISNA, Umm al-Qura, etc.), geographical location (latitude and longitude), date, and local twilight angles for Fajr and Isha prayers.

#### **Core Calculation Parameters:**

* **Method:** Choose from a list of available methods (e.g., MWL, ISNA, Umm al-Qura, etc.).
* **Latitude & Longitude:** Required to calculate the prayer times based on the location.
* **Date:** Prayer times are dynamic and change every day.
* **Time Zone:** To adjust prayer times to the local time zone.
* **Angle:** Adjustments for Fajr and Isha based on local conditions.

### **2. Get Prayer Time Calculation Code**

You don't need to write the calculation code from scratch because there are open-source libraries and APIs that handle prayer time calculations.

#### **Option 1: Use a Flutter Plugin**

* **[adhan_flutter](https://pub.dev/packages/adhan_flutter)** is a popular Flutter package for prayer time calculation. It supports several calculation methods and can easily integrate with your app.

#### **Option 2: Use a Web API**

* **Aladhan API** or **PrayerTimes API** provide prayer times based on your geographical location and preferred calculation method.
* You can fetch the prayer times from the API and display them on your app.

### **3. Integrating Prayer Time Calculation**

#### **Step 1: Set Up Prayer Time Calculation**

**Option 1: Using `adhan_flutter`**

1. **Add dependency** in `pubspec.yaml`:

   ```yaml
   dependencies:
     adhan_flutter: ^2.0.0
   ```

2. **Sample Code to Calculate Prayer Times**:

   ```dart
   import 'package:adhan_flutter/adhan_flutter.dart';

   // Location (latitude, longitude)
   final Coordinates coordinates = Coordinates(latitude, longitude);

   // Calculation method (MWL, ISNA, etc.)
   final CalculationMethod calculationMethod = CalculationMethod.muslimWorldLeague();

   // Time zone
   final prayerTimes = PrayerTimes.today(coordinates, calculationMethod: calculationMethod);

   // Display the prayer times
   print("Fajr: ${prayerTimes.fajr}");
   print("Dhuhr: ${prayerTimes.dhuhr}");
   print("Asr: ${prayerTimes.asr}");
   print("Maghrib: ${prayerTimes.maghrib}");
   print("Isha: ${prayerTimes.isha}");
   ```

   This will calculate and display the prayer times for the current day, based on the user's location and selected calculation method.

**Option 2: Using an API (Aladhan API)**

1. **Fetch Prayer Times** from the API using the user's location and calculation method.

2. **Sample Code to Call the API**:

   ```dart
   import 'dart:convert';
   import 'package:http/http.dart' as http;

   Future<Map<String, dynamic>> fetchPrayerTimes(double latitude, double longitude) async {
     final url = 'http://api.aladhan.com/v1/timings?latitude=$latitude&longitude=$longitude&method=2'; // Method 2 is MWL
     final response = await http.get(Uri.parse(url));

     if (response.statusCode == 200) {
       return json.decode(response.body)['data']['timings'];
     } else {
       throw Exception('Failed to load prayer times');
     }
   }
   ```

3. **Parse and Display** the prayer times in your Flutter app.

### **4. Save Prayer Times in Firebase**

You can save the prayer times in Firebase for later use or push notifications.

1. **Set Up Firebase** in your Flutter project:

   * If you haven't set up Firebase already, follow the official guide for **Flutter + Firebase setup**.

2. **Save Prayer Times in Firestore**:

   ```dart
   import 'package:cloud_firestore/cloud_firestore.dart';

   Future<void> savePrayerTimes(Map<String, dynamic> prayerTimes) async {
     CollectionReference prayerTimesRef = FirebaseFirestore.instance.collection('prayer_times');
     await prayerTimesRef.add({
       'fajr': prayerTimes['Fajr'],
       'dhuhr': prayerTimes['Dhuhr'],
       'asr': prayerTimes['Asr'],
       'maghrib': prayerTimes['Maghrib'],
       'isha': prayerTimes['Isha'],
       'date': DateTime.now(),
     });
   }
   ```

3. **Schedule Push Notifications** (Optional):

   * You can schedule notifications using Firebase Cloud Messaging (FCM) to remind users of the prayer times.
   * Flutter’s **flutter_local_notifications** plugin can help with local notifications.

### **5. Show Prayer Times in UI**

Now, you can build a simple UI to display prayer times for each day. Here’s a basic structure:

1. **Prayer Time Screen**:

   * Show today’s prayer times along with the upcoming times for the next few days.
   * You could display them in a list or a table format.

   ```dart
   class PrayerTimesScreen extends StatelessWidget {
     final Map<String, dynamic> prayerTimes;

     PrayerTimesScreen(this.prayerTimes);

     @override
     Widget build(BuildContext context) {
       return Scaffold(
         appBar: AppBar(title: Text('Prayer Times')),
         body: ListView(
           children: [
             ListTile(title: Text('Fajr: ${prayerTimes['Fajr']}')),
             ListTile(title: Text('Dhuhr: ${prayerTimes['Dhuhr']}')),
             ListTile(title: Text('Asr: ${prayerTimes['Asr']}')),
             ListTile(title: Text('Maghrib: ${prayerTimes['Maghrib']}')),
             ListTile(title: Text('Isha: ${prayerTimes['Isha']}')),
           ],
         ),
       );
     }
   }
   ```

### **6. Additional Features (Optional)**

* **Adjust Prayer Times for Local Conditions**: You can add features to manually adjust prayer times (e.g., for areas with long days or nights, like above the Arctic Circle).

* **Hijri Calendar**: Consider showing prayer times according to the Hijri (Islamic) calendar, as it’s common in many masjids.

* **Qibla Direction**: You can also add a Qibla compass feature using the user's location.

### **7. Test the Feature**

Finally, thoroughly test the feature to ensure:

* Accurate prayer times are being displayed based on the user's location.
* Time zone and daylight saving adjustments are handled correctly.
* Notifications (if implemented) are timely and accurate.

---

### **Conclusion**

By using the `adhan_flutter` library or integrating an API like Aladhan, you can easily calculate prayer times for any location based on the selected calculation method. Saving the prayer times in Firebase helps you persist the data for users and push notifications can be added to remind them of prayer times.

If you have more specific questions about any of these steps or run into challenges during implementation, feel free to ask!
